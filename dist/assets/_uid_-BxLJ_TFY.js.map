{"version":3,"file":"_uid_-BxLJ_TFY.js","sources":["../../src/pages/t/[uid].tsx"],"sourcesContent":["import { useEffect, useState } from \"react\";\nimport { useParams, useSearchParams, useNavigate } from \"react-router-dom\";\nimport { supabase } from \"@/lib/supabase/client\";\n\nexport default function NfcTapPage() {\n    const { uid } = useParams<{ uid: string }>();\n    const [searchParams] = useSearchParams();\n    const navigate = useNavigate();\n    const [error, setError] = useState<string | null>(null);\n    const [loading, setLoading] = useState(true);\n\n    useEffect(() => {\n        async function handleTap() {\n            if (!uid) {\n                setError(\"Keine UID gefunden\");\n                setLoading(false);\n                return;\n            }\n\n            // Fetch chip data\n            const { data: chip, error: fetchError } = await supabase\n                .from(\"chips\")\n                .select(`*, company:companies(*), assigned_user:users(*)`)\n                .eq(\"uid\", uid)\n                .single();\n\n            if (fetchError || !chip) {\n                setError(\"Chip nicht erkannt\");\n                setLoading(false);\n                return;\n            }\n\n            // Log scan (non-blocking)\n            try {\n                await supabase.from(\"scans\").insert({\n                    chip_id: chip.id,\n                    scanned_at: new Date().toISOString(),\n                });\n            } catch (e) {\n                console.error(\"Failed to log scan\", e);\n            }\n\n            // Route based on mode\n            switch (chip.active_mode) {\n                case \"corporate\":\n                case \"vcard\":\n                    if (chip.assigned_user?.slug) {\n                        navigate(`/p/${chip.assigned_user.slug}`, { replace: true });\n                    } else if (chip.assigned_user_id) {\n                        navigate(`/p/${chip.assigned_user_id}`, { replace: true });\n                    }\n                    break;\n\n                case \"hospitality\":\n                case \"menu\":\n                    if (chip.menu_data?.url) {\n                        window.location.href = chip.menu_data.url;\n                    } else {\n                        navigate(`/review/${chip.company_id}`, { replace: true });\n                    }\n                    break;\n\n                case \"campaign\":\n                    navigate(`/campaign/${chip.company_id}`, { replace: true });\n                    break;\n\n                case \"redirect\":\n                    if (chip.target_url) {\n                        window.location.href = chip.target_url;\n                    }\n                    break;\n\n                default:\n                    setError(\"Unbekannter Modus\");\n                    setLoading(false);\n            }\n        }\n\n        handleTap();\n    }, [uid, navigate]);\n\n    if (error) {\n        return (\n            <div className=\"min-h-screen flex items-center justify-center bg-black text-white p-4 text-center\">\n                <div>\n                    <h1 className=\"text-2xl font-bold mb-2 text-red-500\">{error}</h1>\n                    <p className=\"text-zinc-400\">Dieser NFC-Tag ist nicht registriert oder inaktiv.</p>\n                    <p className=\"mt-4 text-xs text-zinc-600\">UID: {uid}</p>\n                </div>\n            </div>\n        );\n    }\n\n    return (\n        <div className=\"min-h-screen flex items-center justify-center bg-black text-white p-4\">\n            <div className=\"flex items-center gap-3\">\n                <div className=\"h-6 w-6 border-2 border-blue-500 border-t-transparent rounded-full animate-spin\" />\n                <span className=\"text-zinc-400\">LÃ¤dt...</span>\n            </div>\n        </div>\n    );\n}\n"],"names":["NfcTapPage","uid","useParams","useSearchParams","navigate","useNavigate","error","setError","useState","loading","setLoading","useEffect","handleTap","chip","fetchError","supabase","e","_a","_b","jsx","jsxs"],"mappings":"2EAIA,SAAwBA,GAAa,CACjC,KAAM,CAAE,IAAAC,CAAA,EAAQC,EAAA,EACOC,EAAA,EACvB,MAAMC,EAAWC,EAAA,EACX,CAACC,EAAOC,CAAQ,EAAIC,EAAAA,SAAwB,IAAI,EAChD,CAACC,EAASC,CAAU,EAAIF,EAAAA,SAAS,EAAI,EAwE3C,OAtEAG,EAAAA,UAAU,IAAM,CACZ,eAAeC,GAAY,SACvB,GAAI,CAACX,EAAK,CACNM,EAAS,oBAAoB,EAC7BG,EAAW,EAAK,EAChB,MACJ,CAGA,KAAM,CAAE,KAAMG,EAAM,MAAOC,GAAe,MAAMC,EAC3C,KAAK,OAAO,EACZ,OAAO,iDAAiD,EACxD,GAAG,MAAOd,CAAG,EACb,OAAA,EAEL,GAAIa,GAAc,CAACD,EAAM,CACrBN,EAAS,oBAAoB,EAC7BG,EAAW,EAAK,EAChB,MACJ,CAGA,GAAI,CACA,MAAMK,EAAS,KAAK,OAAO,EAAE,OAAO,CAChC,QAASF,EAAK,GACd,WAAY,IAAI,KAAA,EAAO,YAAA,CAAY,CACtC,CACL,OAASG,EAAG,CACR,QAAQ,MAAM,qBAAsBA,CAAC,CACzC,CAGA,OAAQH,EAAK,YAAA,CACT,IAAK,YACL,IAAK,SACGI,EAAAJ,EAAK,gBAAL,MAAAI,EAAoB,KACpBb,EAAS,MAAMS,EAAK,cAAc,IAAI,GAAI,CAAE,QAAS,GAAM,EACpDA,EAAK,kBACZT,EAAS,MAAMS,EAAK,gBAAgB,GAAI,CAAE,QAAS,GAAM,EAE7D,MAEJ,IAAK,cACL,IAAK,QACGK,EAAAL,EAAK,YAAL,MAAAK,EAAgB,IAChB,OAAO,SAAS,KAAOL,EAAK,UAAU,IAEtCT,EAAS,WAAWS,EAAK,UAAU,GAAI,CAAE,QAAS,GAAM,EAE5D,MAEJ,IAAK,WACDT,EAAS,aAAaS,EAAK,UAAU,GAAI,CAAE,QAAS,GAAM,EAC1D,MAEJ,IAAK,WACGA,EAAK,aACL,OAAO,SAAS,KAAOA,EAAK,YAEhC,MAEJ,QACIN,EAAS,mBAAmB,EAC5BG,EAAW,EAAK,CAAA,CAE5B,CAEAE,EAAA,CACJ,EAAG,CAACX,EAAKG,CAAQ,CAAC,EAEdE,EAEIa,EAAAA,IAAC,MAAA,CAAI,UAAU,oFACX,gBAAC,MAAA,CACG,SAAA,CAAAA,EAAAA,IAAC,KAAA,CAAG,UAAU,uCAAwC,SAAAb,EAAM,EAC5Da,EAAAA,IAAC,IAAA,CAAE,UAAU,gBAAgB,SAAA,qDAAkD,EAC/EC,EAAAA,KAAC,IAAA,CAAE,UAAU,6BAA6B,SAAA,CAAA,QAAMnB,CAAA,CAAA,CAAI,CAAA,CAAA,CACxD,CAAA,CACJ,QAKH,MAAA,CAAI,UAAU,wEACX,SAAAmB,EAAAA,KAAC,MAAA,CAAI,UAAU,0BACX,SAAA,CAAAD,EAAAA,IAAC,MAAA,CAAI,UAAU,iFAAA,CAAkF,EACjGA,EAAAA,IAAC,OAAA,CAAK,UAAU,gBAAgB,SAAA,SAAA,CAAO,CAAA,CAAA,CAC3C,CAAA,CACJ,CAER"}